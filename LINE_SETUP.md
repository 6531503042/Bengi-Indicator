# LINE Bot Setup Guide

## Credentials ‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏°‡∏µ‡πÅ‡∏•‡πâ‡∏ß ‚úÖ

‡∏à‡∏≤‡∏Å‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏™‡πà‡∏á‡∏°‡∏≤:

- **Channel ID**: `2008553184`
- **Channel Secret**: `6e9ad0fba3f14ecb7e4966df1d134458`
- **Twelve Data API Key**: `a1ca3d33951b458f935941eb8a2f27cc` ‚úÖ

## ‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡∏ï‡πâ‡∏≠‡∏á‡∏´‡∏≤ üîç

### 1. LINE Channel Access Token (‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô)

**‡∏ß‡∏¥‡∏ò‡∏µ‡∏´‡∏≤:**

1. ‡πÑ‡∏õ‡∏ó‡∏µ‡πà LINE Developers Console: https://developers.line.biz/console/
2. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å **Provider** ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
3. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å **Messaging API Channel** ‡∏ó‡∏µ‡πà‡∏°‡∏µ Channel ID: `2008553184`
4. ‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡πÅ‡∏ó‡πá‡∏ö **Messaging API**
5. ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏•‡∏á‡πÑ‡∏õ‡∏´‡∏≤ **Channel access token**
6. ‡∏Ñ‡∏•‡∏¥‡∏Å **Issue** ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á token (‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ)
7. ‡∏Ñ‡∏•‡∏¥‡∏Å **Copy** ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å token

**‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á token:**
```
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
```

‚ö†Ô∏è **‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç**: Token ‡∏à‡∏∞‡∏°‡∏µ 2 ‡πÅ‡∏ö‡∏ö
- **Short-lived token**: ‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏‡πÉ‡∏ô 30 ‡∏ß‡∏±‡∏ô
- **Long-lived token**: ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡∏ô‡∏≤‡∏ô (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥)

### 2. LINE User ID (‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô)

**‡∏ß‡∏¥‡∏ò‡∏µ‡∏´‡∏≤ User ID ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì:**

#### ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà 1: ‡πÉ‡∏ä‡πâ LINE Official Account Manager (‡∏á‡πà‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î)

1. ‡πÑ‡∏õ‡∏ó‡∏µ‡πà https://manager.line.biz/
2. Login ‡∏î‡πâ‡∏ß‡∏¢‡∏ö‡∏±‡∏ç‡∏ä‡∏µ LINE ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
3. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Official Account ‡∏ó‡∏µ‡πà‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏Å‡∏±‡∏ö Channel ID `2008553184`
4. ‡πÑ‡∏õ‡∏ó‡∏µ‡πà **Users** ‚Üí **Friends**
5. ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á (‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏≤‡∏´‡∏≤ bot ‡∏Å‡πà‡∏≠‡∏ô)
6. ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏ä‡∏∑‡πà‡∏≠ ‚Üí ‡∏à‡∏∞‡πÄ‡∏´‡πá‡∏ô **User ID**

#### ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà 2: ‡∏™‡∏£‡πâ‡∏≤‡∏á Webhook Endpoint (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Developer)

1. ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `test-webhook.js`:

```javascript
const express = require('express');
const app = express();

app.use(express.json());

app.post('/webhook', (req, res) => {
  const events = req.body.events;
  events.forEach(event => {
    if (event.type === 'message') {
      console.log('User ID:', event.source.userId);
      console.log('Message:', event.message.text);
    }
  });
  res.sendStatus(200);
});

app.listen(3000, () => {
  console.log('Webhook server running on port 3000');
});
```

2. Deploy ‡πÑ‡∏õ‡∏ó‡∏µ‡πà Railway ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ ngrok:
```bash
ngrok http 3000
```

3. ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Webhook URL ‡πÉ‡∏ô LINE Developers Console:
   - ‡πÑ‡∏õ‡∏ó‡∏µ‡πà **Messaging API** tab
   - ‡πÉ‡∏™‡πà Webhook URL: `https://your-ngrok-url.ngrok.io/webhook`
   - ‡∏Ñ‡∏•‡∏¥‡∏Å **Verify** (‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏î‡πâ success)
   - ‡∏Ñ‡∏•‡∏¥‡∏Å **Update**

4. ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏õ‡∏´‡∏≤ LINE Bot ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì

5. ‡∏î‡∏π logs ‡∏à‡∏∞‡πÄ‡∏´‡πá‡∏ô User ID

#### ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà 3: ‡πÉ‡∏ä‡πâ LINE API Tester

1. ‡πÑ‡∏õ‡∏ó‡∏µ‡πà LINE Developers Console
2. ‡πÑ‡∏õ‡∏ó‡∏µ‡πà **Messaging API** tab
3. ‡πÉ‡∏ä‡πâ **Try it out** section
4. ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏î‡∏™‡∏≠‡∏ö ‚Üí ‡∏à‡∏∞‡πÄ‡∏´‡πá‡∏ô User ID ‡πÉ‡∏ô response

## ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Environment Variables

‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡πÑ‡∏î‡πâ **Channel Access Token** ‡πÅ‡∏•‡∏∞ **User ID** ‡πÅ‡∏•‡πâ‡∏ß:

### ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Local Development

‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `.env`:

```env
# Twelve Data API Key
TWELVE_DATA_API_KEY=a1ca3d33951b458f935941eb8a2f27cc

# LINE Bot Configuration
LINE_CHANNEL_ACCESS_TOKEN=your_channel_access_token_here
LINE_USER_ID=your_user_id_here

# Scheduler
CRON_SCHEDULE=*/5 * * * *

# Optional
SEND_SUMMARY=false
ENABLE_LOGGING=true
```

### ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Railway Deployment

‡πÉ‡∏ô Railway Dashboard ‚Üí **Variables** tab:

1. ‡πÄ‡∏û‡∏¥‡πà‡∏° `TWELVE_DATA_API_KEY` = `a1ca3d33951b458f935941eb8a2f27cc`
2. ‡πÄ‡∏û‡∏¥‡πà‡∏° `LINE_CHANNEL_ACCESS_TOKEN` = (token ‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ)
3. ‡πÄ‡∏û‡∏¥‡πà‡∏° `LINE_USER_ID` = (user id ‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ)
4. ‡πÄ‡∏û‡∏¥‡πà‡∏° `CRON_SCHEDULE` = `*/5 * * * *` (optional)

## ‡∏ó‡∏î‡∏™‡∏≠‡∏ö LINE Bot

### ‡∏ó‡∏î‡∏™‡∏≠‡∏ö Local

1. ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ `.env` ‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö
2. Run:
```bash
npm run build
npm start
```

3. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö logs ‡∏ß‡πà‡∏≤‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à

### ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ö‡∏ô Railway

1. Deploy ‡πÑ‡∏õ Railway
2. ‡∏î‡∏π logs ‡πÉ‡∏ô Railway dashboard
3. ‡∏Ñ‡∏ß‡∏£‡πÄ‡∏´‡πá‡∏ô:
```
‚úÖ Sent signal for 15m to LINE
‚úÖ Sent signal for 1H to LINE
‚úÖ Sent signal for 4H to LINE
```

4. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö LINE ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà

## Troubleshooting

### ‚ùå "Invalid channel access token"

- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ token ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ token ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏
- ‡∏•‡∏≠‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á token ‡πÉ‡∏´‡∏°‡πà

### ‚ùå "User not found" ‡∏´‡∏£‡∏∑‡∏≠ "Invalid user ID"

- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ User ID ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ add friend ‡∏Å‡∏±‡∏ö LINE Bot ‡πÅ‡∏•‡πâ‡∏ß
- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ Messaging API ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß

### ‚ùå ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°

- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ LINE Bot ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß
- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ User ID ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö logs ‡πÉ‡∏ô Railway
- ‡∏•‡∏≠‡∏á‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏õ‡∏´‡∏≤ bot ‡∏Å‡πà‡∏≠‡∏ô (‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ bot ‡∏£‡∏π‡πâ‡∏à‡∏±‡∏Å‡∏Ñ‡∏∏‡∏ì)

## Quick Test Script

‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `test-line.js` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏î‡∏™‡∏≠‡∏ö:

```javascript
require('dotenv').config();
const { Client } = require('@line/bot-sdk');

const client = new Client({
  channelAccessToken: process.env.LINE_CHANNEL_ACCESS_TOKEN,
});

async function test() {
  try {
    await client.pushMessage(process.env.LINE_USER_ID, {
      type: 'text',
      text: 'üß™ Test message from Bengi Indicator Bot!',
    });
    console.log('‚úÖ Message sent successfully!');
  } catch (error) {
    console.error('‚ùå Error:', error.message);
  }
}

test();
```

Run:
```bash
node test-line.js
```

---

**‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÅ‡∏•‡πâ‡∏ß!** ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏î‡πâ Channel Access Token ‡πÅ‡∏•‡∏∞ User ID ‡πÅ‡∏•‡πâ‡∏ß ‡πÅ‡∏Ñ‡πà‡πÉ‡∏™‡πà‡πÉ‡∏ô `.env` ‡∏´‡∏£‡∏∑‡∏≠ Railway variables ‡πÅ‡∏•‡πâ‡∏ß deploy ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢ üöÄ

